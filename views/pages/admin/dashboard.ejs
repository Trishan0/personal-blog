<%- include('../../partials/header') %>
    <header>
        <h1>Admin Dashboard</h1>
    </header>
    <main>
        <div class="container">
            <section class="top-bar">
                <h2>Personal Blog</h2>
                <a href="/admin/new-article">
                    <button class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#fff">
                            <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                        </svg>
                        Add Article
                    </button>
                </a>
            </section>
            <section class="content">
                <h3>Published Articles</h3>
                <% articles.forEach(article=> { %>
                    <div class="line">
                        <p>
                            <%= article.title %>
                        </p>
                        <div class="line-btn">
                            <button class="admin-btn">Edit</button>
                            <button class="admin-btn delete" data-id="<%= article.id %>">Delete</button>
                        </div>
                    </div>
                    <% }) %>
            </section>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 My Blog</p>
    </footer>
    <!-- Include SweetAlert2 from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.min.css">
    <script>
        // Add event listeners to all delete buttons
        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('.admin-btn.delete');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const articleId = this.getAttribute('data-id');
                    confirmDelete(articleId);
                });
            });
        });

        // Function to show delete confirmation using SweetAlert2
        function confirmDelete(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteArticle(id);
                }
            });
        }

        // Function to handle delete request
        function deleteArticle(id) {
            fetch(`/admin/article/${id}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        Swal.fire({
                            title: 'Deleted!',
                            text: 'The article has been deleted.',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false
                        }).then(() => {
                            // Refresh the page after successful deletion
                            window.location.reload();
                        });
                    } else {
                        // Show error message
                        Swal.fire({
                            title: 'Error!',
                            text: 'Failed to delete the article: ' + data.message,
                            icon: 'error'
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Show error message
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred while deleting the article',
                        icon: 'error'
                    });
                });
        }
    </script>
    <%- include('../../partials/footer') %>